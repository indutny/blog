<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>uv_link_t - libuv pipeline</title>
		<meta name="description" content="Darkside of Software Engineering.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Fedor Indutny&#39;s Blog">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Fedor Indutny&#39;s Blog">
		<meta name="generator" content="Eleventy v2.0.1">
		
		<style>/* Only include the syntax highlighter CSS on blog posts */
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: normal;
}

/* Header */
header {
	display: flex;
	gap: 1em .5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
  align-items: center;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}
.nav-item svg.social {
  display: block;
  width: 18px;
  height: 18px;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: .1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

footer {
  padding: 1.5em 0 0.5em 0;
  font-size: 0.75em;
  text-align: right;
}

img {
  max-width: 100%;
  height: auto;
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">Fedor Indutny&#39;s Blog</a>

      
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/blog/">Archive</a></li>
					<li class="nav-item"><a href="/about/">About Me</a></li>
          <li class="nav-item">
            <a href="https://github.com/indutny" target="_blank" rel="noreferrer">
              <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github social" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
            </a>
          </li>
          <li class="nav-item">
            <a href="https://fosstodon.org/@indutny" target="_blank" rel="me">
              <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon social" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg>
            </a>
          </li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>uv_link_t - libuv pipeline</h1>

<ul class="post-metadata">
	<li><time datetime="2016-08-15">15 August 2016</time></li>
</ul>

<h2 id="preface" tabindex="-1">Preface <a class="header-anchor" href="#preface">#</a></h2>
<p>Writing servers/clients in C could be non-trivial. Even with the help of such
powerful (and awesome dinosaur) libraries as <a href="https://github.com/libuv/libuv">libuv</a>, it still takes lots of
effort and boilerplate code to create real world applications.</p>
<p>Some of this boilerplate code comes from the use of the widespread protocols
like TLS (SSL) and HTTP. While there are popular implementations available
as an Open Source libraries (<a href="https://github.com/openssl/openssl">OpenSSL</a>, <a href="https://github.com/nodejs/http-parser">http-parser</a>), they still either
provide very abstract interface (like <a href="https://github.com/nodejs/http-parser">http-parser</a>), or an API to transfer
the responsibility of the networking to the library itself (like <code>SSL_set_fd()</code>
in <a href="https://github.com/openssl/openssl">OpenSSL</a> and Amazon's <a href="https://github.com/awslabs/s2n">s2n</a>). Such abstract nature makes them easier
to embed, but the adaptor code inevitably tend to appear in the particular
applications.</p>
<h2 id="precursor-streambase" tabindex="-1">Precursor - StreamBase <a class="header-anchor" href="#precursor-streambase">#</a></h2>
<p><a href="https://github.com/libuv/libuv">libuv</a> is hardly an exception, and <a href="https://github.com/nodejs/node/blob/master/src/tls_wrap.cc">node.js</a> and <a href="https://github.com/indutny/bud/blob/master/src/client.c">bud</a>'s TLS
implementation is a vivid evidence of this. However, in a contrast to <a href="https://github.com/indutny/bud/blob/master/src/client.c">bud</a>,
<a href="https://github.com/nodejs/node/blob/master/src/tls_wrap.cc">node.js</a> TLS code lives off on an abstraction called <a href="https://github.com/nodejs/node/blob/master/src/stream_base.h">StreamBase</a>. By
separating <a href="https://github.com/libuv/libuv">libuv</a>-specific adaptor code into a generic C++ class, we have
created a foundation for a simpler and reusable implementation of any other
protocol! See, for example, recent <a href="https://github.com/nodejs/node/blob/29228c4089431d0e65749421f43aafd05694f376/src/node_http_parser.cc#L472-L486">node_http_parser.cc</a> which uses only
a minor amount of power available through the means of <a href="https://github.com/nodejs/node/blob/master/src/stream_base.h">StreamBase</a>, but
nevertheless provides <a href="https://github.com/nodejs/node/pull/2355">10-20%</a> performance improvement since its inception.</p>
<p>This implementation has some major drawbacks, preventing its wider adoption
outside of the node.js core:</p>
<ul>
<li>C++ headers: lots of virtual classes, complex API, non-trivial inheritance
scheme</li>
<li>High internal dependence on the node.js core itself</li>
</ul>
<p>Because of these issues (and my own limitations) <a href="https://github.com/nodejs/node/blob/master/src/stream_base.h">StreamBase</a> has defied all
attempts to make it public.</p>
<h2 id="uv-link-t" tabindex="-1">uv_link_t <a class="header-anchor" href="#uv-link-t">#</a></h2>
<p>Heavily inspired by the success of <a href="https://github.com/nodejs/node/blob/master/src/stream_base.h">StreamBase</a> in the node.js core, a
<a href="https://github.com/indutny/uv_link_t">uv_link_t</a> library was created. It has lots of similarities with the
<a href="https://github.com/nodejs/node/blob/master/src/stream_base.h">StreamBase</a>, but it is:</p>
<ul>
<li>Implemented in C: self-documented structures, C-cast based inheritance, etc</li>
<li>Standalone library</li>
</ul>
<p>The API is based on the <a href="http://docs.libuv.org/en/v1.x/stream.html">uv_stream_t</a> and shouldn't come as a big surprise
to the users, since <a href="https://github.com/indutny/uv_link_t">uv_link_t</a> is intended to be used together with
<a href="https://github.com/libuv/libuv">libuv</a>.</p>
<p>Here is a visual explanation of how <a href="https://github.com/libuv/libuv">uv_link_t</a> works:</p>
<p><picture><source type="image/avif" srcset="/img/AoLNueYhpH-717.avif 717w"><source type="image/webp" srcset="/img/AoLNueYhpH-717.webp 717w"><img alt="uv_link_source_t" loading="lazy" decoding="async" src="/img/AoLNueYhpH-717.svg" width="717" height="205"></picture></p>
<h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples">#</a></h2>
<p>Before we take a peek at the APIs, let's discuss what can be done with
<a href="https://github.com/indutny/uv_link_t">uv_link_t</a>. Technically, any stream-based (i.e. anything that uses
<code>uv_stream-t</code>) protocol can be implemented on top of it. Multiple protocols can
be chained together (that's why it is called <code>uv_</code><strong>link</strong><code>_t</code>!), provided that
there is an implementation:</p>
<p><code>TCP &lt;-&gt; TLS &lt;-&gt; HTTP &lt;-&gt; WebSocket</code>.</p>
<p>This chaining works in a pretty transparent way, and every segment of it can be
observed without disturbing the data flow and operation of the other links.</p>
<p>Existing protocols:</p>
<ul>
<li><a href="https://github.com/indutny/uv_ssl_t">uv_ssl_t</a> - TLS, based on OpenSSL's API</li>
<li><a href="https://github.com/indutny/uv_http_t">uv_http_t</a> - low-level HTTP/1.1 implementation, possibly incomplete</li>
</ul>
<p>Small demo-project:</p>
<ul>
<li><a href="https://github.com/indutny/file-shooter">file-shooter</a> - dumb-simple HTTPS server based on both <a href="https://github.com/indutny/uv_ssl_t">uv_ssl_t</a> and
<a href="https://github.com/indutny/uv_http_t">uv_http_t</a></li>
</ul>
<p>Note that all these projects, including <a href="https://github.com/indutny/uv_link_t">uv_link_t</a> itself are supposed to
be built with a <a href="https://github.com/gypkg/gypkg">gypkg</a>, which is a subject for a future blog post.</p>
<h2 id="api" tabindex="-1">API <a class="header-anchor" href="#api">#</a></h2>
<p>The backbone of the API is a <code>uv_link_t</code> structure:</p>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"uv_link_t.h"</span></span><br><br><span class="token keyword">static</span> <span class="token class-name">uv_link_methods_t</span> methods <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token comment">/* To be discussed below */</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token class-name">uv_link_t</span> link<span class="token punctuation">;</span><br><br>  <span class="token function">uv_link_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>link<span class="token punctuation">,</span> <span class="token operator">&amp;</span>methods<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/* ... some operations */</span><br>  <span class="token function">uv_link_close</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>link<span class="token punctuation">,</span> close_cb<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>In the most of the cases a first link should be an <code>uv_link_source_t</code>. It
consumes an instance of <code>uv_stream_t</code>, and propagates reads and writes from
the whole chain of links connected to it.</p>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token class-name">uv_link_source_t</span> source<span class="token punctuation">;</span><br><br><span class="token class-name">uv_stream_t</span><span class="token operator">*</span> to_be_consumed<span class="token punctuation">;</span><br><span class="token function">uv_link_source_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>source<span class="token punctuation">,</span> to_be_consumed<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>As mentioned before, links can be chained together:</p>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token class-name">uv_link_t</span> a<span class="token punctuation">;</span><br><span class="token class-name">uv_link_t</span> b<span class="token punctuation">;</span><br><br><span class="token comment">/* Initialize `a` and `b` */</span><br><span class="token function">uv_link_chain</span><span class="token punctuation">(</span><span class="token comment">/* from */</span> a<span class="token punctuation">,</span> <span class="token comment">/* to */</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This <code>uv_link_chain</code> call means that the data emitted by <code>a</code> will be passed as
an input to <code>b</code>, and the output of <code>b</code> will written to <code>a</code>.</p>
<p>Speaking of input/output, the API is pretty similar to <a href="https://github.com/libuv/libuv">libuv</a>'s:</p>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">uv_link_write</span><span class="token punctuation">(</span><span class="token class-name">uv_link_t</span><span class="token operator">*</span> link<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">uv_buf_t</span> bufs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbufs<span class="token punctuation">,</span> <span class="token class-name">uv_stream_t</span><span class="token operator">*</span> send_handle<span class="token punctuation">,</span><br>                  uv_link_write_cb cb<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">int</span> <span class="token function">uv_link_read_start</span><span class="token punctuation">(</span><span class="token class-name">uv_link_t</span><span class="token operator">*</span> link<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> <span class="token function">uv_link_read_stop</span><span class="token punctuation">(</span><span class="token class-name">uv_link_t</span><span class="token operator">*</span> link<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  link<span class="token operator">-></span>alloc_cb <span class="token operator">=</span> <span class="token comment">/* something */</span><span class="token punctuation">;</span><br>  link<span class="token operator">-></span>read_cb <span class="token operator">=</span> <span class="token comment">/* something */</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Please check the <a href="https://github.com/indutny/uv_link_t/blob/master/docs/api.md">API docs</a> for further information on particular methods
and structures (likes <code>uv_link_source_t</code> and <code>uv_link_observer_t</code>).</p>
<p>There is also an <a href="https://github.com/indutny/uv_link_t/blob/master/docs/implementation-guide.md">Implementation guide</a> for implementing custom types of
<code>uv_link_t</code>.</p>
<h2 id="error-reporting" tabindex="-1">Error reporting <a class="header-anchor" href="#error-reporting">#</a></h2>
<p>Having multiple independent implementations of <code>uv_link_t</code> interface, it is a
natural question to ask: how does <code>uv_link_t</code> handle error code conflict?</p>
<p>The answer is that all error codes returned by <code>uv_link_...</code> methods are
actually prefixed with the index of the particular link in a chain. Thus, even
if there are several similar links in a chain, it is possible to get the pointer
to the <code>uv_link_t</code> instance that have emitted it:</p>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">uv_link_errno</span><span class="token punctuation">(</span><span class="token class-name">uv_link_t</span><span class="token operator">*</span><span class="token operator">*</span> link<span class="token punctuation">,</span> <span class="token keyword">int</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">uv_link_strerror</span><span class="token punctuation">(</span><span class="token class-name">uv_link_t</span><span class="token operator">*</span> link<span class="token punctuation">,</span> <span class="token keyword">int</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="foreword-gypkg" tabindex="-1">Foreword: gypkg <a class="header-anchor" href="#foreword-gypkg">#</a></h2>
<p><a href="https://github.com/gypkg/gypkg">gypkg</a> is recommended to be used when embedding <code>uv_link_t</code> in the C
project. There are not too many source files to put into a <code>Makefile</code> or some
other build file, but the convenience that <a href="https://github.com/gypkg/gypkg">gypkg</a> provides, pays off very
quickly!</p>
<h3 id="installation-node-js-v6-is-required" tabindex="-1">Installation (node.js v6 is required): <a class="header-anchor" href="#installation-node-js-v6-is-required">#</a></h3>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> gypkg</code></pre>
<h3 id="init" tabindex="-1">Init <a class="header-anchor" href="#init">#</a></h3>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">mkdir</span> project<br><span class="token builtin class-name">cd</span> project<br>gypkg init</code></pre>
<h3 id="adding-uv-link-t-as-a-dependency" tabindex="-1">Adding <code>uv_link_t</code> as a dependency <a class="header-anchor" href="#adding-uv-link-t-as-a-dependency">#</a></h3>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">vim</span> project.gyp</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token punctuation">{</span><br>  <span class="token string">"variables"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token string">"gypkg_deps"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"git://github.com/libuv/libuv.git@^1.9.0 => uv.gyp:libuv"</span><span class="token punctuation">,</span><br>      <span class="token string">"git://github.com/indutny/uv_link_t@^1.0.0 [gpg] => uv_link_t.gyp:uv_link_t"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token comment"># Some other GYP things</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="building" tabindex="-1">Building <a class="header-anchor" href="#building">#</a></h3>
<pre class="language-sh" tabindex="0"><code class="language-sh">gypkg build<br><span class="token function">ls</span> <span class="token parameter variable">-la</span> out/Release</code></pre>

<ul class="links-nextprev"><li>Previous: <a href="/d.sea-of-nodes/">Sea of Nodes</a></li><li>Next: <a href="/f.v8-hash-seed-timing-attack/">V8 hash seed timing attack</a></li>
</ul>

		</main>

		<footer>
      Copyright Fedor Indutny 2024;
      <a href="https://github.com/indutny/blog" target="_blank" rel="noreferrer">Released</a>
      under
      <a href="https://opensource.org/licenses/mit-license.php" target="_blank" rel="noreferrer">
        MIT license
      </a>.
    </footer>

		<!-- Current page: /e.uv-link-t/ -->
	</body>
</html>
